<UserControl
    x:Class="SnapIt.Views.WindowsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:prism="http://prismlibrary.com/"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:design="clr-namespace:SnapIt.ViewModels.DesignTime"
    d:DataContext="{d:DesignInstance design:WindowsDesignView,
                                     IsDesignTimeCreatable=True}"
    d:DesignHeight="480"
    d:DesignWidth="640"
    prism:ViewModelLocator.AutoWireViewModel="True"
    mc:Ignorable="d">
    <d:DesignerProperties.DesignStyle>
        <Style TargetType="UserControl">
            <Setter Property="Background" Value="White" />
        </Style>
    </d:DesignerProperties.DesignStyle>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <StackPanel>
            <TextBlock Text="Window" />
            <TextBlock Text="Excluded Applications" />
            <TextBlock
                Grid.Row="1"
                Grid.ColumnSpan="3"
                Margin="0,0,0,6"
                TextWrapping="Wrap">
                <Hyperlink IsEnabled="False">
                    If you don't want to use snapping functionility for certain applications, you can add them to Excluded Applications.
                </Hyperlink>
            </TextBlock>
            <Button HorizontalAlignment="Right" Command="{Binding NewExcludeApplicationCommand}">
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon
                            Width="22"
                            Height="22"
                            Kind="Add" />
                        <TextBlock
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            FontSize="14"
                            Text="New" />
                    </StackPanel>
                </Button.Content>
            </Button>
        </StackPanel>

        <DataGrid
            Grid.Row="1"
            materialDesign:DataGridAssist.CellPadding="13 8 8 8"
            materialDesign:DataGridAssist.ColumnHeaderPadding="8"
            AutoGenerateColumns="False"
            Background="{x:Null}"
            CanUserAddRows="False"
            CanUserSortColumns="True"
            IsReadOnly="True"
            ItemsSource="{Binding ExcludedApplications}">
            <DataGrid.Columns>
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Keyword}"
                    Header="Keyword" />
                <DataGridTextColumn Binding="{Binding MatchRule}" Header="Match Rule" />
                <DataGridTextColumn
                    Width="156"
                    Binding="{Binding AppliedFor, Converter={StaticResource InputDeviceConverter}}"
                    Header="Applied For" />
                <DataGridTemplateColumn Width="64" Header="">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <materialDesign:PopupBox Margin="0,-6,0,-6" PopupMode="Click">
                                <StackPanel>
                                    <Button
                                        Command="{Binding DataContext.EditExcludedApplicationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Content="Edit" />

                                    <Button
                                        Command="{Binding DataContext.RemoveExcludedApplicationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Content="Delete" />
                                </StackPanel>
                            </materialDesign:PopupBox>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <materialDesign:DialogHost Grid.RowSpan="2" IsOpen="{Binding IsExcludeApplicationDialogOpen}">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Width="360" Margin="16">
                    <TextBlock Text="Exclude Application" />

                    <TextBlock TextWrapping="Wrap">
                        <Hyperlink IsEnabled="False">
                            To exclude application, you can choose from running applications or type a keyword and matching rule. If keyword matches to application title, snapping will be disabled for that window.
                        </Hyperlink>
                    </TextBlock>

                    <Button
                        Margin="0,16"
                        HorizontalAlignment="Center"
                        Command="{Binding OpenRunningApplicationsDialogCommand}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="FolderSearchOutline" />
                                <TextBlock Margin="8,0,0,0" Text="choose from running applications" />
                            </StackPanel>
                        </Button.Content>
                    </Button>

                    <TextBlock Margin="0,0,0,12" HorizontalAlignment="Center">
                        <Hyperlink IsEnabled="False">
                            or
                        </Hyperlink>
                    </TextBlock>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="Keyword" />
                        <TextBox
                            Grid.Row="1"
                            Margin="0,0,6,0"
                            HorizontalAlignment="Stretch"
                            Text="{Binding SelectedExcludedApplication.Keyword, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock Grid.Column="1" Text="Match Rule" />
                        <ComboBox
                            Grid.Row="1"
                            Grid.Column="1"
                            ItemsSource="{Binding MatchRules}"
                            SelectedItem="{Binding SelectedExcludedApplication.MatchRule, Mode=TwoWay}" />
                    </Grid>

                    <TextBlock Margin="0,8" Text="Applied for" />

                    <StackPanel Orientation="Horizontal">
                        <CheckBox Content="Mouse" IsChecked="{Binding SelectedExcludedApplication.Mouse}" />
                        <CheckBox
                            Margin="12,0,0,0"
                            Content="Keyboard"
                            IsChecked="{Binding SelectedExcludedApplication.Keyboard}" />
                    </StackPanel>

                    <StackPanel
                        Margin="0,24,0,0"
                        HorizontalAlignment="Center"
                        Orientation="Horizontal">
                        <Button
                            Margin="0,0,20,0"
                            Command="{Binding ExcludeApplicationDialogClosingCommand}"
                            CommandParameter="{StaticResource TrueValue}"
                            Content="Save"
                            IsDefault="True" />
                        <Button
                            Margin="20,0,0,0"
                            Command="{Binding ExcludeApplicationDialogClosingCommand}"
                            CommandParameter="{StaticResource FalseValue}"
                            Content="Cancel"
                            IsDefault="False" />
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>

        <materialDesign:DialogHost
            Grid.RowSpan="2"
            CloseOnClickAway="True"
            IsOpen="{Binding IsRunningApplicationsDialogOpen}">
            <materialDesign:DialogHost.DialogContent>
                <Grid Width="360" Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <TextBlock Text="Running Applications" />

                    <ListBox
                        Grid.Row="1"
                        Margin="0,8,0,0"
                        ItemsSource="{Binding RunningApplications}"
                        SelectedItem="{Binding SelectedExcludedApplication.Keyword}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="SelectionChanged">
                                <i:InvokeCommandAction Command="{Binding CloseRunningApplicationsDialogCommand}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </ListBox>
                </Grid>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
    </Grid>
</UserControl>